#summary ミドルウェア (11)

= Terrain =

Terrain（テレイン）とは「地形」の意味。ゲーム開発用語としては、地形を扱うための技術のことを広くさして言う。かなり曖昧な用語。

Unityには統合的なTerrainエディタが搭載されている。これを使ってできることは以下の通り。

  * ハイトマップによる、お絵かき感覚での地形エディット。
  * お絵かき感覚でのツリー（木）配置。
  * お絵かき感覚での草配置。

全体的にお絵かき感覚。それでいて、LODやらアニメーションやらは自動でやってくれる。

= 準備 =

Asset Storeから[http://u3d.as/content/unity-technologies/terrain-assets/1qQ Terrain Assets]をダウンロード＆インポートしておく（授業ではG-Serverに置いておきます）。

Terrainの上を走らすためのクルマのプレハブを用意しておいた。[http://vga-unity.googlecode.com/files/HMMWV.unitypackage ここからダウンロードして]インポートしておく。

= Terrainを作る =

メインメニューの"Terrain"から"Create Terrain"を選ぶ。

かなり広いTerrainが作成されるので、適当に移動してカメラが中央に来るようにする。(-1000, 0, -1000)ぐらいに移動すればOK。

適当に光源を配置する。

= 地面に模様を描く =

Terrainを選択し、Inspector内のツールの中から絵筆のアイコンを選ぶ。

描く前に、まずテクスチャを追加しなければいけない。"Textures"のところにある"Edit Textures..."ボタンを押して"Add Texture..."を選択。するとダイアログが表示される

ダイアログ内の"Splat"の項目に好きなテクスチャをドラッグ＆ドロップする。地形用のテクスチャは"!TerrainAssets/Textures"の中に用意されているので、好きなのを選んで"Add"する。

最初に選んだテクスチャは、Terrain全体を塗り潰すために勝手に使われる。２つ目以降は、絵筆のテクスチャとして使うものになる。

"Brush Size"でブラシのサイズが、"Opacity"でブラシの濃さが変更できる。

草地をベースとして、砂っぽいテクスチャで道のようなものを描いてみる。

= とりあえず走ってみる =

HMMWVプレハブをシーンに追加する。するとクルマ（ハンヴィー）が出現する。ハンヴィーにはカメラが付いているので、元からあったMain Cameraは削除する。

ゲームをプレイすると、Terrain上をクルマで走ることができる。左右でステアリング、上でアクセル、下でバック。

= 高低差を作る =

山に上向き矢印のついているアイコンを選択すると、高低差をエディットするモードに入る。シーンをドラッグするだけで、地形が盛り上がる。Shiftを押しながらだと、地形が下がる。

Brush SizeとOpacityを上手く調節して、コース外に山を作ってみる。

= 高低差の補助ツール =

山に上下矢印のついているアイコンは、地形を一定の高さに近づけるモード。Shiftを押しながらクリックで、その地点の高さを取得して、あとはドラッグすると、その高さで塗っていくことができる。

山に水滴のついているアイコンは、高低差をなだらかにするモード。凸凹が付き過ぎた場合にこれで撫でると、適度になだらかになる。

これらの補助ツールを使って、コースらしい高低差に調節していく。

= 木を植える =

木のアイコンは、木のモデルを植えるモード。

まず、木のモデルを登録しなければいけない。"Edit Trees..."ボタンを押して"Add Tree"を選択すると、ダイアログが表示される。

ダイアログの"Tree"にモデルをドラッグ＆ドロップして登録する。木のモデルはTerrain AssetsのTrees Ambient-Occlusionの中に用意されている。

木を登録したら、あとは植えたい木を選択してから、シーン上をドラッグするだけ。

"Tree Density"は、木を植える密度を調節する。"Tree Height"や"Tree Width"で、植える木の高さや幅を変更できる。その下の"Variation"をいじると、高さや幅がランダムになる。

Shiftを押しながらドラッグで、植えた木を消すことができる。

= 草を植える =

花のアイコンは、草を植えるモード。

まず、草のテクスチャを登録しなければいけない。登録の要領は、だいたい木の場合と同じ。草の素材はTerrain AssetsのGrassに入っているので、好きなのをドラッグ＆ドロップする。

草は、カメラから遠くになると非表示になるので注意すること。シーンビュー上では植えたのが見えなくでも、近寄ってみるとちゃんと植わっていた、ということがよくある。

= Terrain全体の調整 =

歯車アイコンを押すと、Terrain全体の設定を調整するためのインタフェースが出現する。

この中で最も重要なのは"Detail Distance"の設定。ここに設定された距離よりも離れた要素は、描画が簡略化される。例えば、草はこの距離を越えると非表示になる。

草がバリバリと消えて気になる場合は、この距離を適度に上げるとよい。ただし、描画負荷も相応に上がるので注意すること。

= フォグの設定 =

フォグ(fog)とは「霞効果」を与えるための設定。遠くの物体を霞ませるために使う。

Terrainを使う場合、距離によって細部の簡略化が入るが、簡略化の様子が目に入ってしまうと違和感になる。これを目立たなくするためにフォグを使うとよい。

フォグを使うには、メインメニューの"Edit"→"Rendering Settings..."を選択し、"Fog"のチェックボックスをオンにする。"Fog Color"でフォグの色を、"Fog Density"でフォグの濃さを調節できる。

= 課題 =

[http://dl.dropbox.com/u/14572092/VgaUnity/Terrain.html 手本]のようなものを作成する。

手本の出来は、あまりよくない……以下の点を意識して、より面白いコースを作ってみて欲しい。

  * 緩急のあるカーブ設定。
  * オフロードらしさの感じられる高低差。
  * コースの先の展開が自然と分かる設計（障害物の配置がコツ）。

クルマのパラメーターを調整するのもアリ。

来週の授業開始時に回収。

== 提出ディレクトリ ==

{{{
\\G-Server\Public\GP\Unity\Middleware0803
}}}