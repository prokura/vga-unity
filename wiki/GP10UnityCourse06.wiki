#summary ミドルウェア (6)

= イントロ =

  * 先週のおさらい。
  * 手本の作り方をレクチャー。
  * 課題の回収。

= Texture （テクスチャ） =

  * テクスチャマッピング：面に画像を貼り付けること。
  * 今は、なんでも画像のことは「テクスチャ」というようになってしまった感じが……

=== Unityでテクスチャを使うには ===

画像ファイルをProjectビューにドラッグ＆ドロップするだけ。

= Material （マテリアル） =

  * Material ＝「材質」
  * CGの世界では、面の見た目を決めるデータ構造のこと。

=== Unityでマテリアルを作るには ===

ProjectビューのCreateメニューからMaterialを選ぶ。

= シェーダー =

  * レンダリングに使われる特殊なプログラムの（シェーダープログラム）。
  * シェーダーを入れ替えることによって、様々な見た目を作り出せる。
  * Unityでは[http://unity3d.com/support/documentation/Components/SL-Reference.html 自分でシェーダーを書くこともできる]が、一般的なものはプリセットとして用意されている。

=== Unityでシェーダーを切り替えるには ===

マテリアルを選択してから、Inspectorビューの上部分に表示されるShaderプルダウンを操作する。

= Diffuse （拡散反射） =

  * 最も一般的なシェーダー。物体表面での乱反射のシミュレーション。
  * 鈍い反射を表現する。テカリが無い、ツヤ消し状態の面。
  * 光の方向と面の法線だけで明るさが決まる。

  * テクスチャを1個だけ貼れる。
  * Main Colorで色を操作できる。

  * テクスチャのTilingで、テクスチャをループさせることができる。
  * テクスチャのOffsetで、貼りつけの開始位置を変えることができる（テクスチャスクロール）。

= Specular （鏡面反射） =

  * 物体表面での正反射のシミュレーション。金属などの表面で起こる。
  * 鋭い反射を表現する。テカリが生じる。
  * 光の入射角と視点方向によって明るさが変化する。

  * テクスチャを1個だけ貼れる。
  * Specular Colorでテカリの明るさを、Shininessでテカリの鋭さを操作できる。

= Transparent （透過） =

  * 透明な面を扱うためのもの。
  * メニューの"Transparent"の下にバリエーションが用意されている。例えば"Transparent/Diffuse"なら、Diffuseをベースとして透過するマテリアルになる。
  * 色のアルファチャンネルよって透過率が変化する。
  * アルファチャンネルを持ったテクスチャを使うか、Main Colorでアルファ値を下げるかして、透過させる。

= Decal （デカール付き拡散反射） =

  * テクスチャを同時に2枚貼れるシェーダー。
  * Baseの上にDecalが貼られる。Decalはアルファを含む（透過する）ものでないと意味が無い。
  * いわゆるマルチテクスチャ

= Self-Illumin(ated) （自己発光） =

  * 自ら光を放っている面を表現するもの。
  * 光源との関係によらず、常に一定の明るさを持つ。
  * 陰を付けたくない場合に使う。
    * 本当はlightmapを使うときに効果があるもの。

= Bumped Diffuse / Bumped Specular （バンプマッピング） =

  * バンプ（凸凹）を表現するシェーダー。
  * バンプはノーマルマップ（法線マップ）によって表現する。
  * 法線マップとは[http://www.google.com/search?q=normal+map&tbm=isch こんなの]。画像のR, G, B値によって法線ベクトルのX, Y, Z成分に偏位を与える。

=== 法線マップの作り方 ===

  * 法線マップを手作業で作るのは難しい。多くの場合、ハイトマップ（高度マップ）から生成される。
  * ハイトマップとは、高さを色の明るさで表したもの。

  * まず、白黒画像を普通にテクスチャとして読み込む。
  * Inspectorビュー上で、Texture ImporterのTexture Typeをnormal mapにする。
  * "Generate from greyscale"をオンにする。

  * 最近はモデルと法線マップを同時に制作するツール（[http://www.youtube.com/watch?v=M5fYgsdrOaA ZBrush等]）も一般的になってきた。

= Parallax Diffuse / Parallax Specular （パララックスマッピング） =

  * バンプマッピングの改良版。
  * バンプマッピングは明るさが凸凹するだけ。パララックスマッピングは、見た目も凸凹させる。
  * 原理的にはバンプマッピングよりも高品質なはず……だが、下手に使っても案外効果は無い。
  * かなり描画負荷が高いので注意。

  * Heightmapにハイトマップを与える必要がある。
  * 法線マップを作るのに使ったハイトマップをそのまま与えればよい。ただし、高さの値をアルファチャンネルに入れる必要がある。これには、Texture Importerにある"Generate Alpha from Greyscale"を使うとよい。

= Cubemap （キューブマップ） =

http://en.wikipedia.org/wiki/Cube_mapping

  * 環境マッピングに使われるマッピング方式の一種。
   * 環境マッピングとは、反射による映り込みを表現するための手法。物体の周囲の景色を画像化したもの。
  * 物体の周囲の景色を箱状に写し取る。6面の画像によって構成される。

  * 環境マッピングの方式には、他にも色々ある。例えばスフィアマップとか……
  * http://ict.debevec.org/~debevec/Probes/
  * 最近ではグラフィクスチップがキューブマップに対応しているため、もっぱらキューブマップが使われるようになっている。

=== Unityでキューブマップを作るには ===

  * 6枚の画像からキューブマップを構築する方法と、他の形式から変換する方法と、二通りある。
  * ここでは、シリンダー型のパノラマ画像から変換する方法を使う。

  * シリンダー型のパノラマ画像は、パノラマ画像を自作する人の間でよく使われている。
  * 正式名称は[http://ja.wikipedia.org/wiki/正距円筒図法 正距円筒図法](equirectangular projection)。
  * フリーで使えるものが入手しやすい。例えば[http://www.flickr.com/search/?q=equirectangular&l=cc&ss=0&ct=0&mt=all&w=all&adv=1 flickrで検索する]など。

  * まず、Projectビューにドラッグ＆ドロップで普通に取り込み。
  * Texture Typeを"Reflection"にする。Mappingは"Cylindrical"にする。

= RenderFX/Skybox Cubed =

  * キューブマップを背景にするためのシェーダー。
  * Cubemapにキューブマップを設定する。Tint Colorで色の調整。
  * メインメニューの"Edit"→"Render Settings"でRender Settingsを開く。その中にあるSkybox Materialに、このマテリアルをドラッグ＆ドロップする。

= Reflective （反射） =

  * 反射による映り込みを表現する。いわゆる環境マッピング。
  * メニューの"Reflective"の下にバリエーションが用意されている。例えば"Reflective/Diffuse"なら、Diffuseをベースとして反射するマテリアルになる。

  * Reflection Cubemapに映り込みのためのキューブマップを設定する。
  * Baseで下地となるテクスチャを設定することもできる。アルファ値で反射成分の割合を操作。

  * 反射とバンプの組み合わせなど、かなりどぎつい表現になる。